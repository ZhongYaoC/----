### 测试项目

#### 测试所用硬件参数

CPU：Core i7 6700HQ

内存：16GB

磁盘：5400RPM 1TB机械硬盘

#### 1、paxos实例连续发起

**本次测试中，每个chosen的实例值未写入（仅在acceptor节点保存有最新的一个实例值），计划单独线程中放入队列，然后依次写入磁盘；log cache中仅做内存侧的写入**

##### 结论：

每个实例均经历P1、P2两阶段（因为测试中选举被屏蔽，未跳过P1阶段），且未开启磁盘同步下，总耗时：

（两节点）100轮实例，每个实例值大小为10字节；总耗时为38 s 324331 us，每个实例均耗时383ms

**0929重新测试，居然变快了，23s**

（两节点）100轮实例，每个实例值大小为100字节；总耗时为37 s 544389 us

（两节点）100轮实例，每个实例值大小为1024字节；总耗时为40s 369955 us

（三节点）100轮实例，每个实例值大小为10字节；总耗时为58 s 235746 us

##### 各阶段耗时分析：

（两节点）100轮实例下，从发出prepare报文开始计时，至收到半数以上回复为止，视为P1阶段耗时；

从发出propose报文开始计时，至收到半数以上回复为止，视为P2阶段耗时。

P1阶段平均耗时为140ms，P2阶段平均耗时128ms

比较奇怪的是，实例进行到91之后，耗时大幅下滑，从平均150-165ms下降到53-62ms

【图】

#### 2、选举

##### 2.1、paxos lease

当前参数设置为租约为7s，获取租约的超时时长为3s，续租发起时机为获取租约后的1.4s；由节点3在初始化时主动申请租约。

P1阶段平均耗时148ms，P2阶段平均耗时107ms；具体数据为测试1次选主，8次续租，出现一次续租耗时异常高，达到670ms，其余续租耗时基本在80-100ms之间

主节点主动关闭后，前任租期到期后剩余节点自动发起申请租约。

【图】



##### 2.2、fast election

当前参数设置为租约（超时时间）2s，间隔100ms发送心跳（续租），而在最终确认状态之前会等待200ms，防止有最新的投票到达；由三个节点在启动后检查各自状态，满足半数以上在线即发起选举。

自满足半数以上节点存活，并开始选举至选举成功，耗时 1 s , 150215 us，即1150ms，较于lease选举耗时较长，但是选举后续租更快，因为续租只需要保持心跳报文即可，lease中需要全程经历P1、P2两阶段。



#### 3、目录发送

测试不同目录数量和不同文件数量大小情况下，两节点之间传送耗时：

测试参数为发送时的文件块大小为64KB，即65536B

测试目录下存在1个文件，大小为1K、10K、20K、30K...100K、1000K、10000K、100000K

该目录下存在10个文件，大小相等，分别为1K，10K，100K、1000K、10000K





最终综合速度估算为为1.9MB/s左右



#### 4、磁盘同步

测试开启磁盘同步和关闭磁盘同步下，写入不同的数据量的耗时