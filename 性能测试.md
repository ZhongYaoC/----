paxos性能测试小计





时间：2022年4月7日 20：00

测试内容：100个paxos instance用时和开启fsync/FlushFileBuffers下的磁盘写入次数

对象：2进程作为2节点，相互通信

结果：

当前为第100轮
总计写入磁盘400次
本次耗时: 29 s 735309 us



时间：2022年4月7日 23：00

测试内容：磁盘同步耗时

对象：

结果：

写入1024 Byte数据用时: 0 s 111586 us    111ms

写入10240 Byte数据用时: 0 s 152427 us   152ms

写入102400 Byte数据用时: 0 s 117443 us  117ms

写入204800 Byte数据用时: 0 s 120429 us  120ms

写入307200 Byte数据用时: 0 s 145824 us  145ms

写入409600 Byte数据用时: 0 s 161281 us   161ms



写入1024 Byte数据用时: 0 s 49002 us

写入10240 Byte数据用时: 0 s 26969 us

写入102400 Byte数据用时: 0 s 39270 us

写入204800 Byte数据用时: 0 s 26427 us

写入307200 Byte数据用时: 0 s 21700 us

写入409600 Byte数据用时: 0 s 25881 us

写入512000 Byte数据用时: 0 s 27363 us

写入614400 Byte数据用时: 0 s 31329 us

写入716800 Byte数据用时: 0 s 32443 us

写入819200 Byte数据用时: 0 s 41809 us

写入921600 Byte数据用时: 0 s 34211 us

写入1024000 Byte数据用时: 0 s 37001 us



写入102400 Byte数据用时: 0 s 50049 us

写入204800 Byte数据用时: 0 s 97300 us

写入307200 Byte数据用时: 0 s 27781 us

写入409600 Byte数据用时: 0 s 53310 us

写入512000 Byte数据用时: 0 s 26185 us

写入614400 Byte数据用时: 0 s 36061 us

写入716800 Byte数据用时: 0 s 34321 us

写入819200 Byte数据用时: 0 s 66672 us

写入921600 Byte数据用时: 0 s 36031 us

写入1024000 Byte数据用时: 0 s 37026 us





写入102400 Byte数据用时: 0 s 142128 us

写入204800 Byte数据用时: 0 s 29190 us

写入307200 Byte数据用时: 0 s 28992 us

写入409600 Byte数据用时: 0 s 33971 us

写入512000 Byte数据用时: 0 s 39998 us

写入614400 Byte数据用时: 0 s 37967 us

写入716800 Byte数据用时: 0 s 35980 us

写入819200 Byte数据用时: 0 s 31997 us

写入921600 Byte数据用时: 0 s 41765 us

写入1024000 Byte数据用时: 0 s 34980 us





写入102400 Byte数据用时: 0 s 23010 us
写入204800 Byte数据用时: 0 s 27827 us
写入307200 Byte数据用时: 0 s 25834 us
写入409600 Byte数据用时: 0 s 24034 us
写入512000 Byte数据用时: 0 s 28075 us
写入614400 Byte数据用时: 0 s 32522 us
写入716800 Byte数据用时: 0 s 37636 us
写入819200 Byte数据用时: 0 s 33887 us
写入921600 Byte数据用时: 0 s 33572 us
写入1024000 Byte数据用时: 0 s 29977 us







时间：2022年4月15日 09：58

测试内容：100个paxos instance用时（未开启磁盘同步）

对象：2进程作为2节点，相互通信

结果：

当前为第100轮

本次耗时: 7 s 826410 us

本次耗时: 6 s 840040 us

本次耗时: 7 s 390479 us

最早测试似乎仅为4s左右？？？





测试项目

1、paxos实例连续发起

各个阶段耗时，单实例chosen耗时；

开启磁盘同步与否

结论：

每个实例均经历P1、P2两阶段（因为测试中选举被屏蔽），且未开启磁盘同步下，总耗时：

（两节点）100轮实例，每个实例大小为10字节；总耗时为38 s 324331 us，每个实例均耗时383ms

（两节点）100轮实例，每个实例大小为100字节；总耗时为

（两节点）100轮实例，每个实例大小为1024字节；总耗时为40s 369955 us

（三节点）100轮实例，每个实例大小为10字节；总耗时为58 s 235746 us

各阶段耗时分析：

（两节点）100轮实例下，从发出prepare报文开始计时，至收到半数以上回复为止，视为P1阶段耗时；

从发出propose报文开始计时，至收到半数以上回复为止，视为P2阶段耗时。

P1阶段平均耗时为140ms，P2阶段平均耗时128ms

比较奇怪的是，实例进行到91之后，耗时大幅下滑，从平均150-165ms下降到53-62ms



2、选举

各个阶段耗时，出现故障之后，恢复所用时间

2.1、paxos lease

当前参数设置为租约为7s，获取租约的超时时长为3s，续租发起时机为获取租约后的1.4s；由节点3在初始化时主动申请租约。

P1阶段平均耗时148ms，P2阶段平均耗时107ms；具体数据为测试1次选主，8次续租，出现一次续租耗时异常高，达到670ms，其余续租耗时基本在80-100ms之间

主节点主动关闭后，前任租期到期后剩余节点自动发起申请租约。



2.2、fast election

当前参数设置为租约（超时时间）2s，间隔100ms发送心跳（续租），而在最终确认状态之前会等待200ms，防止有最新的投票到达；由三个节点在启动后检查各自状态，满足半数以上在线即发起选举。

自满足半数以上节点存活，并开始选举至选举成功，耗时 1 s , 150215 us，即1150ms



3、目录发送

测试不同目录数量和不同文件数量大小情况下，传送耗时

测试两节点之间传送耗时

测试参数为发送时的文件块大小为64KB，即65536B

传送目录：

该目录下存在1个文件，大小为1K、10K、20K、30K...1M

该目录下存在10个文件，大小相等，为1K，10K，20K









4、磁盘同步

测试开启磁盘同步和关闭磁盘同步下，写入不同的数据量的耗时

